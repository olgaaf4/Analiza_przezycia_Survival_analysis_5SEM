---
title: "Analiza_przeżycia_2"
author: "Olga Foriasz"
date: "2025-10-15"
output:
  pdf_document: default
  html_document: default
header-includes:
- \usepackage[OT4]{polski}
- \usepackage{float}
subtitle: Analiza przeżycia
fontsize: 11pt
---
# LISTA 2

## Zadanie 1 - Generowanie n zmiennych cenzurowanych

Do wygenerowania n zmiennych cenzurowanych z uogólnionego rozkładu wykładniczego **GE($\lambda, \alpha$)** I-go typu wykorzystaliśmy generowanie zmiennych losowych z rozkładu jednostajnego U(0,1). Następnie dla każdej zmiennej zastosowano wzór odwróceonej dystrybuanty, a kolejno dla X[i] większych od $t_0$ zamieniono je na wartość $t_0$, i zaznaczono cenzurowanie poprzez $\delta$ = 0.

```{r}

## wzor : F(t)=(1-e)^(-lambda*t)
## t= -(1/lambda)*ln(1-p^(1/alfa))

typ_I <- function(t0, alfa, lambda, n){
  p <- runif(n)
  X<-numeric(n)
  delta <-numeric(n)
  for(i in 1:n){
  X[i]=(-(1/lambda))*log(1-(p[i])^(1/alfa))
  if(X[i]>t0){
    X[i] <- t0
    delta[i] <- 0
  }else{delta[i]<-1}}
  return(data.frame(X = X, delta = delta))
}


```

Aby wygenerować n zmiennych cenzurowanych z uogólnionego rozkładu wykładniczego **GE($\lambda, \alpha$)** typu II, zastosowaliśmy metodę dystrybuanty odwrotnej. Następnie posortowaliśmy wektor X, a od wartości $X_m$ każdą kolejną obserwację zastąpiliśmy właśnie tą wartością. Wektorowi cenzurowania $\delta$ przypisaliśmy odpowiednio: 1 dla obserwacji niecenzurowanych oraz 0 dla cenzurowanych

```{r}
typ_II <- function(m, alfa, lambda, n){
  p <- runif(n)
  X<-numeric(n)
  delta <-numeric(n)
  for(i in 1:n){
  X[i]=(-(1/lambda))*log(1-(p[i])^(1/alfa))}
  sort(X)
  for (i in (n-m):n){
    X[i] <- X[m]
    delta[i] <- 0
  }
  for(i in 1:m){delta[i]=1}
  return(data.frame(X = X, delta = delta))
}
```

Do wygenerowania n zmiennych z rozkładu  **GE($\lambda, \alpha$)** przy cenzurowaniu losowym (niezależnym) wygenerowano n liczb losowych z rozkładu U(0,1) i zastosowano metodę odwróconej dystrybuanty. Następnie wygenerowano wektor C z rozkładu wykładniczego E($\eta$) oraz przypisano wskaźnik cenzurowania $\delta$=1 dla obserwacji niecenzurowanych i 0 dla cenzurowanych.

```{r}

cenz_losowo <- function(eta, alfa, lambda, n){
  p <- runif(n)
  X<-numeric(n)
  C<-numeric(n)
  delta <-numeric(n)
  for(i in 1:n){
  X[i]=(-(1/lambda))*log(1-(p[i])^(1/alfa))
  C[i]=rexp(1, rate=1/eta)
  X[i]=min(X[i],C[i])
  if(X[i]== C[i]){
    delta[i]=0
  }else{delta[i]=1}
  }
  return(data.frame(X = X, delta = delta))
}
  
```

## Zadanie 2 - Generowanie danych cenzurowanych

Korzystając z napisanych funkcji wygenerowaliśmy zestaw 40 danych dla cenzurowania:

* typu I-go:
```{r}
dane_1 <- typ_I(1,0.5,1,40)
head(dane_1,5)
```

  
* typu II-go:
```{r}
dane_2 <- typ_II(10,0.5,1,40)
head(dane_2,5)
```
  
* losowego:
```{r}
dane_3 <- cenz_losowo(0.23,0.5,1,40)
head(dane_3,5)
```

Następnie dla danych wyznaczyliśmy statystyki opisowe przedstawione w Tabeli 3. Poprzez **dane_1** oznaczono dane zawierające zmienne w przypadku cenzurowania I-go typu. **Dane_2** - zawierają zmienne w przypadku cenzurowania II-go typu, a **dane_3** - w przypadku cenzurowania losowego(niezależnego).

```{r, echo=FALSE}

statystyki <- function(x,y){
  min <- min(x)
  dol_kwartyl <- quantile(x, 0.25)
  gor_kwartyl <- quantile(x, 0.75)
  mediana <- median(x)
  maks <- max(x)
  rozstep <- maks - min
  ile=0
  for(i in y){
    if(i==0){ile=ile+1}
  }
  odsetek = ile/length(x)
  return(list(
    min = min,
    dol_kwartyl = dol_kwartyl,
    gor_kwartyl = gor_kwartyl,
    mediana = mediana,
    maks = maks,
    rozstep = rozstep,
    ile_cenz = ile,
    odsetek_cenz = odsetek
  ))
}
wyniki_1 <- statystyki(dane_1$X,dane_1$delta)
wyniki_2 <- statystyki(dane_2$X, dane_2$delta)
wyniki_3 <- statystyki(dane_3$X, dane_3$delta)


```

```{r, echo=FALSE, results='asis', comment=FALSE, message=FALSE}
library(xtable)

wyniki <- rbind(
  cbind(Zestaw = "dane_1", data.frame(wyniki_1)),
  cbind(Zestaw = "dane_2", data.frame(wyniki_2)),
  cbind(Zestaw = "dane_3", data.frame(wyniki_3))
)

tabela <- xtable(wyniki, digits=5, caption='Statystyki opisowe', label='tab_3') 
colnames(tabela) <- c('dane','min','dolny_kwartyl','gorny_kwartyl','mediana','maks', 'rozstep','liczba cenz','odsetek')

print(tabela, type='latex', table.placement='H', caption.placement='top', include.rownames=FALSE,  comment = FALSE)

```

Przy statystykach opisowych dla danych cenzurowanych wzięliśmy pod uwagę wartości takich statytsyk jak minimum, maksimum, rozstęp, kwartyl górny i dolny, medianę, liczbę danych cenzurowanych oraz ich odsetek. Dzięki temu możliwa jest szybka ocena stopnia cenzurowania oraz porównanie podstawowych charakterystyk rozkładu między różnymi zestawami danych. Należy jednak pamiętać, że uzyskane statystyki klasyczne (np. mediana, kwartyle) mogą być zniekształcone przez obecność danych cenzurowanych, dlatego ich interpretacja powinna być ostrożna. Mimo to funkcja stanowi użyteczne narzędzie do wstępnego opisu i porównania zbiorów danych zawierających obserwacje niepełne.


## zad.3 - Zadanie praktyczne

```{r, echo=FALSE, results='asis', comment=FALSE}
n=20
t0=1
delta=numeric(n)
grupa_A <- numeric(n)
grupa_B <- numeric(n)

grupa_A[1:10] <- c(0.03345514, 0.08656403, 0.08799947, 0.24385821, 0.27755032,
0.40787247, 0.58825664, 0.64125620, 0.90679161, 0.94222208)

grupa_B[1:10] <- c(0.03788958, 0.12207257, 0.20319983, 0.24474299, 0.30492413,
0.34224462, 0.42950144, 0.44484582, 0.63805066, 0.69119721)

## cenzurowanie I-go typu

grupa_A[11:20] <- t0
grupa_B[11:20] <- t0

delta_A <- c(rep(1, 10), rep(0, 10))
delta_B <- c(rep(1, 10), rep(0, 10))

dane_A <- data.frame(czas = grupa_A, delta = delta_A)
dane_B <- data.frame(czas = grupa_B, delta = delta_B)

## wyznaczenie statystyk
stat_1<- statystyki(dane_A$czas,dane_A$delta)
stat_2<- statystyki(dane_B$czas,dane_B$delta)

## tworzenie tabeli
library(xtable)

wyniki <- rbind(
  cbind(Zestaw = "grupa_A", data.frame(stat_1)),
  cbind(Zestaw = "grupa_B", data.frame(stat_2))
)

tabela <- xtable(wyniki, digits=5, caption='Statystyki opisowe', label='tab_4') 
colnames(tabela) <- c('dane','min','dolny_kwartyl','gorny_kwartyl','mediana','maks', 'rozstep','liczba cenz','odsetek')

print(tabela, caption.placement='top',table.placement='H',include.rownames=FALSE,  comment = FALSE)

```

W przypadku obu grup odsetek danych cenzurowanych jest taki sam - w zestawach A i B występuje po 10 obserwacji cenzurowanych oraz 10 niecenzurowanych. Patrząc na wartości minimalne, można zauważyć, że czas do osiągnięcia remisji w grupie A był nieznacznie krótszy niż w grupie B. Dane cenzurowane mają wartość $t_0$ = 1, ponieważ obserwacja trwała przez rok, dlatego w obu przypadkach maksimum jest jednakowe i równe 1. Mediana w grupie A wynosi 0,97, a w grupie B – 0,85. Dolne kwartyle dla grup A i B wynoszą odpowiednio 0,38 i 0,33, natomiast górny kwartyl w obu przypadkach wynosi 1. Wyniki te można interpretować w ten sposób, że choć minimalny czas wystąpienia remisji był krótszy w grupie A, to większa liczba pacjentów osiągnęła remisję szybciej w grupie B. Można więc wnioskować, że mimo szybszych początkowych efektów leku w grupie A, ostatecznie lek B okazał się skuteczniejszy.

